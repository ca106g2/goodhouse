function Union(t){var e=this;if(!(this instanceof Union))return new Union(t);e.defaults={pid:"",callback:null,isCreatImg:!0,regionid:regionid,param:""},t=t||{};for(var n in t)t.hasOwnProperty(n)&&(e.defaults[n]=t[n]);var o=document.getElementById("unionTouch");e.defaults.isTouch=!!o;var i="callback=unionName_"+e.defaults.pid+"&pid="+e.defaults.pid+"&regionid="+e.defaults.regionid;e.scriptUrl="//union.591.com.tw/cpt?"+i+(e.defaults.isTouch?"&device=touch":"")+(e.defaults.param?"&"+e.defaults.param:""),e.defaults.pid&&e.init()}function getCookie(t){if(document.cookie.length>0){var e=document.cookie.indexOf(t+"=");if(-1!==e){e=e+t.length+1;var n=document.cookie.indexOf(";",e);return-1===n&&(n=document.cookie.length),decodeURIComponent(document.cookie.substring(e,n))}}return""}function getBoundingClientRect(t){var e=t.getBoundingClientRect();return{top:e.top,left:e.left,bottom:e.bottom,right:e.right,width:e.width||e.right-e.left,height:e.height||e.bottom-e.top}}!function(){function t(t,e){for(var n=-1,o=t.length;++n<o;)if(n in t&&t[n]===e)return n;return-1}var e={click:1,dblclick:1,keyup:1,keypress:1,keydown:1,mousedown:1,mouseup:1,mousemove:1,mouseover:1,mouseenter:1,mouseleave:1,mouseout:1,storage:1,storagecommit:1,textinput:1};if("undefined"!=typeof document&&"undefined"!=typeof window){var n=window.Event&&window.Event.prototype||null;window.Event=Window.prototype.Event=function(t,e){if(!t)throw new Error("Not enough arguments");var n;if("createEvent"in document){n=document.createEvent("Event");var o=!(!e||void 0===e.bubbles)&&e.bubbles,i=!(!e||void 0===e.cancelable)&&e.cancelable;return n.initEvent(t,o,i),n}return n=document.createEventObject(),n.type=t,n.bubbles=!(!e||void 0===e.bubbles)&&e.bubbles,n.cancelable=!(!e||void 0===e.cancelable)&&e.cancelable,n},n&&Object.defineProperty(window.Event,"prototype",{configurable:!1,enumerable:!1,writable:!0,value:n}),"createEvent"in document||(window.addEventListener=Window.prototype.addEventListener=Document.prototype.addEventListener=Element.prototype.addEventListener=function(){var n=this,o=arguments[0],i=arguments[1];if(n===window&&o in e)throw new Error("In IE8 the event: "+o+" is not available on the window object. Please see https://github.com/Financial-Times/polyfill-service/issues/317 for more information.");n._events||(n._events={}),n._events[o]||(n._events[o]=function(e){var o,i=n._events[e.type].list,r=i.slice(),a=-1,c=r.length;for(e.preventDefault=function(){!1!==e.cancelable&&(e.returnValue=!1)},e.stopPropagation=function(){e.cancelBubble=!0},e.stopImmediatePropagation=function(){e.cancelBubble=!0,e.cancelImmediate=!0},e.currentTarget=n,e.relatedTarget=e.fromElement||null,e.target=e.target||e.srcElement||n,e.timeStamp=(new Date).getTime(),e.clientX&&(e.pageX=e.clientX+document.documentElement.scrollLeft,e.pageY=e.clientY+document.documentElement.scrollTop);++a<c&&!e.cancelImmediate;)a in r&&(o=r[a],-1!==t(i,o)&&"function"==typeof o&&o.call(n,e))},n._events[o].list=[],n.attachEvent&&n.attachEvent("on"+o,n._events[o])),n._events[o].list.push(i)},window.removeEventListener=Window.prototype.removeEventListener=Document.prototype.removeEventListener=Element.prototype.removeEventListener=function(){var e,n=this,o=arguments[0],i=arguments[1];n._events&&n._events[o]&&n._events[o].list&&-1!==(e=t(n._events[o].list,i))&&(n._events[o].list.splice(e,1),n._events[o].list.length||(n.detachEvent&&n.detachEvent("on"+o,n._events[o]),delete n._events[o]))},window.dispatchEvent=Window.prototype.dispatchEvent=Document.prototype.dispatchEvent=Element.prototype.dispatchEvent=function(t){if(!arguments.length)throw new Error("Not enough arguments");if(!t||"string"!=typeof t.type)throw new Error("DOM Events Exception 0");var e=this,n=t.type;try{if(!t.bubbles){t.cancelBubble=!0;var o=function(t){t.cancelBubble=!0,(e||window).detachEvent("on"+n,o)};this.attachEvent("on"+n,o)}this.fireEvent("on"+n,t)}catch(o){t.target=e;do{t.currentTarget=e,"_events"in e&&"function"==typeof e._events[n]&&e._events[n].call(e,t),"function"==typeof e["on"+n]&&e["on"+n].call(e,t),e=9===e.nodeType?e.parentWindow:e.parentNode}while(e&&!t.cancelBubble)}return!0},document.attachEvent("onreadystatechange",function(){"complete"===document.readyState&&document.dispatchEvent(new Event("DOMContentLoaded",{bubbles:!0}))}))}}(),function(t){function e(t,e){return function(){t.apply(e,arguments)}}function n(t){if("object"!=typeof this)throw new TypeError("Promises must be constructed via new");if("function"!=typeof t)throw new TypeError("not a function");this._state=null,this._value=null,this._deferreds=[],u(t,e(i,this),e(r,this))}function o(t){var e=this;if(null===this._state)return void this._deferreds.push(t);d(function(){var n=e._state?t.onFulfilled:t.onRejected;if(null===n)return void(e._state?t.resolve:t.reject)(e._value);var o;try{o=n(e._value)}catch(e){return void t.reject(e)}t.resolve(o)})}function i(t){try{if(t===this)throw new TypeError("A promise cannot be resolved with itself.");if(t&&("object"==typeof t||"function"==typeof t)){var n=t.then;if("function"==typeof n)return void u(e(n,t),e(i,this),e(r,this))}this._state=!0,this._value=t,a.call(this)}catch(t){r.call(this,t)}}function r(t){this._state=!1,this._value=t,a.call(this)}function a(){for(var t=0,e=this._deferreds.length;t<e;t++)o.call(this,this._deferreds[t]);this._deferreds=null}function c(t,e,n,o){this.onFulfilled="function"==typeof t?t:null,this.onRejected="function"==typeof e?e:null,this.resolve=n,this.reject=o}function u(t,e,n){var o=!1;try{t(function(t){o||(o=!0,e(t))},function(t){o||(o=!0,n(t))})}catch(t){if(o)return;o=!0,n(t)}}var d="function"==typeof setImmediate&&setImmediate||function(t){setTimeout(t,1)},l=Array.isArray||function(t){return"[object Array]"===Object.prototype.toString.call(t)};n.prototype.catch=function(t){return this.then(null,t)},n.prototype.then=function(t,e){var i=this;return new n(function(n,r){o.call(i,new c(t,e,n,r))})},n.all=function(){var t=Array.prototype.slice.call(1===arguments.length&&l(arguments[0])?arguments[0]:arguments);return new n(function(e,n){function o(r,a){try{if(a&&("object"==typeof a||"function"==typeof a)){var c=a.then;if("function"==typeof c)return void c.call(a,function(t){o(r,t)},n)}t[r]=a,0==--i&&e(t)}catch(t){n(t)}}if(0===t.length)return e([]);for(var i=t.length,r=0;r<t.length;r++)o(r,t[r])})},n.resolve=function(t){return t&&"object"==typeof t&&t.constructor===n?t:new n(function(e){e(t)})},n.reject=function(t){return new n(function(e,n){n(t)})},n.race=function(t){return new n(function(e,n){for(var o=0,i=t.length;o<i;o++)t[o].then(e,n)})},n._setImmediateFn=function(t){d=t},n.prototype.always=function(t){var e=this.constructor;return this.then(function(n){return e.resolve(t()).then(function(){return n})},function(n){return e.resolve(t()).then(function(){throw n})})},"undefined"!=typeof module&&module.exports?module.exports=n:t.Promise||(t.Promise=n)}(this);var REGION=[];REGION[1]={id:1,txt:"台北市"},REGION[3]={id:3,txt:"新北市"},REGION[6]={id:6,txt:"桃園市"},REGION[4]={id:4,txt:"新竹市"},REGION[5]={id:5,txt:"新竹縣"},REGION[21]={id:21,txt:"宜蘭縣"},REGION[2]={id:2,txt:"基隆市"},REGION[8]={id:8,txt:"台中市"},REGION[10]={id:10,txt:"彰化縣"},REGION[14]={id:14,txt:"雲林縣"},REGION[7]={id:7,txt:"苗栗縣"},REGION[11]={id:11,txt:"南投縣"},REGION[17]={id:17,txt:"高雄市"},REGION[15]={id:15,txt:"台南市"},REGION[12]={id:12,txt:"嘉義市"},REGION[13]={id:13,txt:"嘉義縣"},REGION[19]={id:19,txt:"屏東縣"},REGION[22]={id:22,txt:"台東縣"},REGION[23]={id:23,txt:"花蓮縣"},REGION[24]={id:24,txt:"澎湖縣"},REGION[25]={id:25,txt:"金門縣"},REGION[26]={id:26,txt:"連江縣"};var regionid=getCookie("urlJumpIp")||1,token=getCookie("T591_TOKEN")||"",REGION_TXT=REGION[regionid]?REGION[regionid].txt:REGION[1].txt;window.UNION_SHOW=Union,Union.prototype={init:function(){var t=this;this.getScript(t.scriptUrl),t.callbackFun()},createImg:function(t){var e={src:t.src||"",alt:t.alt||"",data:t.data||null};return new Promise(function(t,n){var o=new Image;o.onload=t(o),o.onerror=n(new Error("Could not load image at "+e.src)),o.src=e.src})},creatHTML:function(t){var e=this,n=e.getGAString(t.position_name,t.order_number,1);return new Promise(function(o,i){function r(i){e.hotEventSend(n);var r=e.createLink({href:t.url&&e.addToken(t.event_click_url),title:t.txt,target:!e.defaults.isTouch,attrValue:e.getGAString(t.position_name,t.order_number)});"string"==typeof i?r.innerHTML=i:r.appendChild(i),r.appendChild(e.createStatImg(t.event_show_url,n)),o(r)}2===t.pd_type?r(t.txt):e.createImg({src:t.img}).then(function(t){r(t)})})},createStatImg:function(t,e){var n=document.createElement("div");return n.setAttribute("data-union-stat",this.addToken(t)),n.setAttribute("data-gtm-str",e),n.className="unionDataStat",n.innerHTML='<img src="'+this.addToken(t)+'" style="display:none"/>',n},createLink:function(t){var e={href:t.href||"javascript:;",title:t.title||"",target:t.target&&!0,attrName:t.attrName||"data-gtm-stat",attrValue:t.attrValue||"UnionEvent_缺省_"+t.title},n=document.createElement("a");return n.setAttribute(e.attrName,e.attrValue),n.href=e.href,n.className="union-wrap",e.target&&t.href&&(n.target="_blank"),n},createManyHTML:function(t,e){function n(t){var e=o.regroup(t,"order_type"),n=e.length,i=!1;if(2===n)for(var r=0;r<n;r++)1===e[r].name&&(i=e[r]);return i}for(var o=this,i=o.regroup(t,"row"),r=0;r<i.length;r++){var a=i[r],c=a.name,u=n(a.items);u&&(a=u);var d=o.random(0,a.items.length-1);!function(t,n){o.creatHTML(n).then(function(i){document.getElementById(e+t).innerHTML=i.outerHTML,o.scrollSendStat(document.getElementById(e+t),n)})}(c,a.items[d])}},scrollEventHandler:function(t){var e={ele:t.ele||"",twoThirdHiddeEvent:t.twoThirdHiddeEvent||"",twoThirdShowEvent:t.twoThirdShowEvent||"",triggerOne:t.triggerOne||!0};if(""===e.ele)return!1;var n,o=window.innerHeight||document.documentElement.clientHeight,i=function(){if(!e.ele.clientHeight)return document.removeEventListener("scroll",i,!1),!1;var t=getBoundingClientRect(e.ele.clientHeight?e.ele:document.getElementById(e.ele.id));t.top<=o-2*t.height/3&&t.bottom>=2*t.height/3&&(e.triggerOne?(void 0===n||n)&&(e.twoThirdShowEvent&&e.twoThirdShowEvent(),n=!1):e.twoThirdShowEvent&&e.twoThirdShowEvent()),(t.top+1*t.height/3>o||t.bottom<1*t.height/3)&&(e.triggerOne?void 0!==n&&n||(e.twoThirdHiddeEvent&&e.twoThirdHiddeEvent(),n=!0):e.twoThirdHiddeEvent&&e.twoThirdHiddeEvent())};i(),document.removeEventListener("scroll",i,!1),document.addEventListener("scroll",i,!1)},callbackFun:function(){var t=this;window["unionName_"+t.defaults.pid]=function(e){var n=Object.keys(e.data),o=n[0],i=1===n.length?e.data[o]:e.data;if(t.defaults.callback&&t.defaults.callback.call(t,i),t.defaults.isCreatImg){var r=e.data[o],a=r.length,c=t.random(0,a-1),u=document.getElementById("UNION_"+t.defaults.pid);a>0?t.creatHTML(r[c]).then(function(e){u&&(u.innerHTML=e.outerHTML),u&&t.scrollSendStat(u,r[c])}):u&&(u.innerHTML="")}window["unionName_"+t.defaults.pid]=function(){console.warn("未找到unionName_"+t.defaults.pid+"方法！")}}},hotEventSend:function(t){try{hotEventSend(t)}catch(n){var e=t&&t.split("_");t&&dataLayer.push({event:"public_hot_event",hot_event_1:e[0],hot_event_2:e[1],hot_event_3:e[2],hot_event_4:e[3]})}},addToken:function(t){return t+"&_u="+token},getGAString:function(t,e,n){return(1===n?"廣告瀏覽-Union":"廣告點擊-Union")+"_"+REGION_TXT+"-"+t+"_"+(e||1)},random:function(t,e){return parseInt(Math.random()*(e-t+1)+t,10)},getNumberArray:function(t){for(var e=[],n=0;n<t;n++)e.push(n);return e},shuffle:function(t){return t.sort(function(){return Math.random()>.5?-1:1})},getScript:function(t,e){var n=document.createElement("script");n.type="text/javascript",n.src=t,n.onload=n.onreadystatechange=function(){this.readyState&&"loaded"!==this.readyState&&"complete"!==this.readyState||(this.onload=this.onreadystatechange=null,this.parentNode.removeChild(this)),e&&e()},document.getElementsByTagName("head")[0].appendChild(n)},regroup:function(t,e){for(var n=[],o={},i=0,r=0,a=t.length;r<a;r++){var c=t[r];o.hasOwnProperty(c[e])?n[o[c[e]]].items.push(c):(o[c[e]]=i++,n.push({name:c[e],items:[c]}))}return n},scrollSendStat:function(t,e){var n=this;!function(t,e){n.scrollEventHandler({ele:t,twoThirdShowEvent:function(){n.sendUnionStat(n.getGAString(e.position_name,e.order_number,1),n.addToken(e.event_show_url))}})}(t,e)},nativeDataAdapter:function(t,e){for(var n=!1,o=this,i=t.length,r=0;r<i;r++)if(void 0!==t[r].is_native&&1===t[r].is_native){n=!0;var a=e||t[r].position_name;t[r].event_show_url=o.addToken(t[r].event_show_url),t[r].event_click_url=o.addToken(t[r].event_click_url),t[r].data_gtm_click=o.getGAString(a,t[r].native_orderno),t[r].data_gtm_show=o.getGAString(a,t[r].native_orderno,1),o.hotEventSend(t[r].data_gtm_show)}return{data:t,isNative:n}},sendUnionStat:function(t,e){this.hotEventSend(t),(new Image).src=e}};